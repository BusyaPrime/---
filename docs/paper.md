# PDE-LAB: Высокопроизводительный Вычислительный Фреймворк для Систем Конвекции-Диффузии
## Абстракт (Суть)
Выкатываем zero-allocation, cache-friendly Java 21 фреймворк для сурового численного аппроксимирования 2D уравнения конвекции-диффузии. Спроектированный по строгим канонам HPC (High-Performance Computing), PDE-LAB выжимает нативное bare-metal КПД, сохраняя при этом сэйфти и портативность JVM. Главные архитектурные киллер-фичи: геометрический Multigrid (MG) V-cycle прекондей для сопряженных градиентов (PCG), дающий железобетонный $O(N)$ скейлинг; MUSCL TVD схема, прокачанная Minmod лимитерами для подавления осцилляций на разрывах; и гармоническое усреднение интерфейсов для сеток с переменной диффузией $\kappa$. 

## 1. Уравнения и Пространственная Дискретизация (Матан в коде)
Система крутит обобщенное 2D транзиентное уравнение конвекции-диффузии:
$$ \frac{\partial u}{\partial t} = \nabla \cdot (\kappa \nabla u) - \mathbf{b} \cdot \nabla u + f(\mathbf{x}, t) $$

### 1.1 Ядро Диффузии ($\nabla \cdot \kappa \nabla u$) 
Обычные конечные разности (finite difference) позорно сыпятся на резких перепадах коэффициентов теплопроводности (разрывы сред). PDE-LAB юзает dual-grid подход, честно вычисляя дискретную диффузию $\kappa$ прямо на гранях ячеек через **Гармоническое Усреднение** (Harmonic Averaging). 

Берем $\kappa_{i+1/2, j} = \left( \frac{1}{2} \left[ \frac{1}{\kappa_{i,j}} + \frac{1}{\kappa_{i+1,j}} \right] \right)^{-1}$. Такой расчет потоков гарантирует непрерывность на границах фаз и просто разрывает в клочья тупое арифметическое среднее, которое искусственно "размазывает" скачки теплопроводности.

### 1.2 Конвекция. Схема MUSCL TVD (Гасим осцилляции)
Наивные upwind схемы (против потока) 1-го порядка обладают дикой паразитной диссипацией (все размывают), а крутые центральные разности высоких порядков генерят нефизичные волны (эффект Гиббса). PDE-LAB хакает эту вилку, юзая **MUSCL** (Monotonic Upstream-centered Scheme for Conservation Laws). Мы собираем потоки на гранях ячеек $u^L_{i+1/2}$ и $u^R_{i+1/2}$ с помощью **Minmod лимитера (ограничителя)** $\phi(r)$:

$$ u_{i+1/2}^L = u_i + \frac{1}{2}\phi(r_i)(u_{i} - u_{i-1}) $$
где $r_i = \frac{u_{i+1} - u_i}{u_{i} - u_{i-1}} $.  Эта штука гарантирует выполнение условия TVD (Total Variation Diminishing), элегантно падая до 1-го порядка upwind в точках экстремумов ($r < 0$), но вытягивая царскую точность $O(h^2)$ везде, где данные гладкие. Жесткие тесты (например, Вращающийся Гауссов Холм на чистой адвекции) пруфают, что мы режем осцилляции прямо на сетке.

## 2. Архитектура Солвера: PCG & Geometric Multigrid (Многосеточный прекондей)
### 2.1 Предобусловленные Сопряженные Градиенты (PCG)
Неявные схемы (Crank-Nicolson / Backward Euler) генерят жирные блочно-трехдиагональные матрицы. Мы решаем это через PCG без ленивой сборки плотных матриц в памяти. Вся алгебра крутится *matrix-free* через супер-оптимизированные обходы плоских массивов (cache-contiguous row sweeps, `applyLaplacian`).

### 2.2 Оптимальный Прекондей: V-Cycle Multigrid
Спектральное число обусловленности неявного лапласиана улетает по $O(N)$. Прекондей Якоби неплохо сбивает высокочастотную невязку, но всухую сливает низкочастотным артефактам. **PDE-LAB Genius Edition** кроет это оптимальным $O(N)$ Геометрическим Многосеточным Прекондеем (Multigrid).

Проецируя мелкие невязки $\mathbf{r}_h$ на грубую сетку $\mathbf{r}_{2h}$ через интерполяцию рестрикции (Full-Weighting Restriction), PDE-LAB рекурсивно сглаживает глобальные косяки. Затем мы делаем билинейную пролонгацию (Bilinear Prolongation) обратно на мелкий уровень и жестко доглаживаем симметричным Взвешенным Якоби (Weighted-Jacobi, $\omega \approx 0.8$).

## 3. HPC Механика и Zero-Allocation в трубах (Доим железо)
### 3.1 Линейная Топология Памяти
Все многомерные узлы ($[Nx, Ny]$) раскатаны в тупые плоские 1-D примитивные массивы `double[]`. Логика агрессивно откусывает математически важные *внутренние* узлы сетки от детерменированных *граничных* баферов. Это помножает на ноль все пенальти за branch misprediction внутри параллельного матан-ядра.

### 3.2 GC-Immune Daemon Engine (Сказка без Гарбич Коллектора)
Чтобы выдержать зеро-аллокационный инвариант, популярный `ForkJoinPool` (который с каждым `invokeAll` плодит кучи объектов `Callable`) был выкинут на свалку. PDE-LAB спавнит статик `Thread` воркеры, которые вяжутся жестким тросом к `CyclicBarrier`. Потоки крутятся и синкаются чисто на хардварных примитивах синхронизации самой ОС, сливая GC-мусор от шагов солвера до абсолютных $0$ байт/шап.

```java
// Дефолтный джава-энтерпрайз (мусорное ведро):
// ExecutorService.invoke() -> спавнит леса Future / Callable объектов
// PDE-LAB Zero-Alloc Подход (Путь Самурая):
// barrier.await() -> Unsafe.park(), нативная atomic CAS синхронизация
```

## 4. Пруфы Воспроизводимости и Верификация (Факты на стол)
Академические математические пруфы железобетонно вшиты в CI пайплайны PDE-LAB через метод **MMS (Method of Manufactured Solutions)**.

### 4.1 $L_2$ и Соболевские $H^1$ Метрики
Порядок сходимости ловится программно через регрессии наименьших квадратов (least-squares regressions). Сходимость пространственной ошибки бьет точно $m \approx -2.0$ ($O(h^2)$). Дополнительно мы чекаем $L_2$ жесткой Соболевской $H^1$ метрикой (шоб градиенты не поехали):
$$ || e ||_{H^1} = \left( \sum ( \partial_x e_{i,j} )^2 + ( \partial_y e_{i,j} )^2 \right)^{1/2} $$

### 4.2 JFR и Масштабирование (Скейлимся в потолок)
Дергая JFR (Java Flight Recorder) снепшоты на лету прям во время счета, юзеры доказывают алгоритмическую сложность без магии. Скрипт `run_all.sh` собирает все артефакты от нативного железа (Strong Scaling), пруфая $O(p)$ скейлинг по закону Амдала вплоть до отрисовки графиков.

## Вывод (Conclusion)
PDE-LAB берет жесткий академический матан (Minmod лимитеры, топовые Multigrid солверы) и вдалбливает его напрямую в hardened JVM-продакшен экосистему. Выходные артефакты - это уникальная солянка лоу-латенси bare-metal перфоманса с математически-запруфанной до последней цифры точностью.
